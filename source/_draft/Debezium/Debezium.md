# 为什么读取shema

https://debezium.io/documentation/reference/connectors/mysql.html#mysql-schema-history-topic

# snapshot read
在启动扫描全表前，先加一个全局读锁（FLUSH TABLES WITH READ LOCK），然后获取此时的Binlog位点以及表的schema，紧接着释放全局读锁。随后开始扫描全表，当全表数据读取完后，会从之前获取的Binlog位点获取增量的变更记录
运行期间会周期性执行checkpoint，记录下Binlog位点，当作业发生Failover，便会从之前记录的Binlog位点继续处理，从而实现Exactly Once语义。

never：指定连接永远不要使用快照，并且在第一次使用逻辑服务器名称启动时，连接器应该从binlog的开头读取；请谨慎使用，因为只有在binlog保证包含数据库的整个历史记录时才有效。
schema_only：如果自连接器启动以来不需要数据的连续快照，而只需要它们进行更改，则可以使用该schema_only选项，其中连接器仅对模式（而不是数据）进行快照。

snapshot.locking.mode

minimal: 连接器仅对快照的初始部分持有全局读取锁定，在此期间，连接器读取数据库架构和其他元数据。快照中的其余工作涉及从每个表中选择所有行。连接器可以使用REPEATABLE READ事务以一致的方式执行此操作。即使不再拥有全局读取锁并且其他MySQL客户端正在更新数据库时，也是如此。

minimal_percona: 连接器仅在快照的初始部分持有全局备份锁，在此期间，连接器读取数据库架构和其他元数据。快照中的其余工作涉及从每个表中选择所有行。连接器可以使用REPEATABLE READ事务以一致的方式执行此操作。即使不再持有全局备份锁并且其他MySQL客户端正在更新数据库，情况也是如此。此模式不会将表刷新到磁盘，不会被长时间运行的读取阻止，并且仅在Percona Server中可用。

extended: 在快照期间阻止所有写入。如果存在正在提交MySQL从REPEATABLE READ语义中排除的操作的客户端，请使用此设置。

none: 防止连接器在快照期间获取任何表锁。尽管所有快照模式都允许使用此设置，但是只有在快照运行时没有架构更改发生的情况下，才可以安全使用。对于使用MyISAM引擎定义的表，尽管已设置此属性，但表仍将被锁定，因为MyISAM获取表锁定。此行为与InnoDB引擎不同，后者获取行级锁。

![](http://www.plantuml.com/plantuml/svg/TOxThS8m38NVCqKMo0PNLwKiW805J69Q2zT1ZllMuK4YHIBG9__uypcdAmPgyyJEaHZg5IBw8q92TQ_Y_vOGdgkO9HAJ33q9vw4o-n58C5KqXEL__OPBCOLeVbURRzNjaz8mMl0zvtWZMStUOykTQSBKm1_QrQz6tmPE0lSovbzP3w30ZDmWhaD9yyGF)

