11.5、G1回收器

原来的垃圾回收器(Serial、Parallel、CMS)将内存分成三个分代：新生代、老年代和固定大小的永久代。每个分代都是一块连续的内存，这样的缺点是任意一个分代Resize的时候会重新分配每个分代的内存区域，也意味着会触发一次FullGC。

G1将Java堆分成大小相等的区块(Region)，原来概念上的Eden，Survivor，OldGen可以分布在不连续的区块上。这些区块的大小在1M~32M之间，默认情况下JVM会根据栈内存大小动态计算，可以通过`-XX:G1HeapRegionSize`参数调节。

![G1 Heap Allocation](http://ww1.sinaimg.cn/large/bda5cd74ly1fxtzjxdbvmj20jp0d5jrk.jpg)

新生代GC仍使用拷贝算法：

![Young Generation GC](http://ww1.sinaimg.cn/large/bda5cd74ly1fxu08iimyyg20mi0cmgm2.gif)

老年代分成以下几个阶段：

| 阶段               |
| ------------------ |
| 初始标记(STW)      |
| Root区扫描并发标记 |
| 重新标记(STW)      |
| 清理(STW)          |
| 复制(STW)          |

![](http://ww1.sinaimg.cn/large/bda5cd74ly1fxu0kj27zvg20ml0evt9e.gif)

