---
title: è®°ä¸€æ¬¡VPCé—®é¢˜çš„æ’æŸ¥
date: 2021-03-03
categories: Linuxè¿ç»´
tags: Linux
---

å‰å‡ å¤©æ–°ä¹°äº†å°æœºå™¨æƒ³ç”¨æ¥åšæ—¥å¿—åˆ†æï¼Œå‘ç°ä¸¤å°æœºå™¨ç”¨å†…ç½‘åœ°å€æ­»æ´»è¿ä¸ä¸Šï¼Œè…¾è®¯äº‘æ–‡æ¡£ä¸Šéƒ½è¯´åŒä¸€VPCä¸‹ä¸åŒå­ç½‘é»˜è®¤æ˜¯äº’é€šçš„ã€‚æœ€åå‘è…¾è®¯äº‘æäº†ä¸ªå·¥å•æ‰å‘ç°æ˜¯è‡ªå·±æœåŠ¡å™¨dockerç½‘æ®µå’Œå†…ç½‘ç½‘æ®µå†²çªå¯¼è‡´çš„ã€‚è¿™é‡Œè®°å½•ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹çš„å§‹æœ«ã€‚

# 1ã€ ç”³è¯·äº†å°æ–°æœºå™¨

ä¹‹å‰é‚£å°æœºå™¨æ˜¯å¤§å­¦é‡Œä¹°çš„ï¼Œç©·é€¼å­¦ç”Ÿæœºé…ç½®ï¼š1æ ¸CPUã€1Gå†…å­˜ã€1Må¸¦å®½ï¼ŒElasticSearchèµ·éƒ½èµ·ä¸æ¥ï¼Œæ¼«å¤©OOMã€‚

æ‰€ä»¥æ–°å¼„äº†å°2Gçš„æœºå™¨ï¼Œå•ç‹¬åšæ—¥å¿—åˆ†æã€‚

![server](https://p.pstatp.com/origin/pgc-image/9038b52b19b64847a62f6312c6335a7f)

# 2ã€å…¬ç½‘ä¸è¡Œï¼Œç”¨å†…ç½‘ï¼Œå¯æ˜¯å†…ç½‘ä¹Ÿä¸é€š

ç©·é€¼ä¸€ä¸ªï¼Œæ–°æœºå™¨ä¹Ÿåªä¹°äº†1Må¸¦å®½ï¼Œæ‰€ä»¥ä¸¤å°æœºå™¨è‚¯å®šæ˜¯ä¸èƒ½é€šè¿‡å…¬ç½‘æ¥è¿›è¡Œé€šä¿¡çš„ã€‚

é‚£å°±ç”¨å†…ç½‘åœ°å€å’¯ã€‚

åŒä¸€ç§æœ‰ç½‘ç»œä¸‹ï¼Œä¸åŒå­ç½‘å†…ç½‘ä¸é€šã€‚å…¬ç½‘pingæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å†…ç½‘æ— æ³•è¿æ¥ã€‚

![ping](https://p.pstatp.com/origin/pgc-image/219f414e43da43ffa61094e25d75d13e)
![ping](https://p.pstatp.com/origin/pgc-image/128055bc6f9b4221beaee61ea6a76281)

# 3ã€å®‰å…¨ç»„ç­–ç•¥çš„é—®é¢˜ï¼Ÿ

å› ä¸ºåˆšå¼€å§‹å®‰å…¨ç»„å…¥ç«™è§„åˆ™ï¼Œæˆ‘æ˜¯æŠŠICMPçš„pingç»™ç¦ç”¨äº†çš„ï¼Œæ‰€ä»¥ä¸“é—¨æŠŠICMPå¼€æ”¾äº†

![å®‰å…¨ç»„ç­–ç•¥](https://p.pstatp.com/origin/pgc-image/7ea5195936d4441c9892d4a388afb777)

# 4ã€åŸæ¥æ˜¯è·¯ç”±é—®é¢˜

æˆ‘è£…äº†ä¸ªtelentå°è¯•ç”¨åˆ«çš„åè®®è¿ä¸€ä¸‹ï¼Œè¿™ä¸ªæŠ¥é”™è®©æˆ‘å‘ç°äº†é—®é¢˜çš„å…³é”®: è·¯ç”±é…ç½®æœ‰é—®é¢˜

![telnet](https://p.pstatp.com/origin/pgc-image/0be08b7079e34d68ad676a16e509a55f)

æˆ‘çœ‹äº†ä¸‹è·¯ç”±è¡¨

![è·¯ç”±è¡¨](https://p.pstatp.com/origin/pgc-image/8e7751c8623b4d2eaf7ff1cbf76f49ac)

å¯ä»¥çœ‹åˆ°dockerç½‘ç»œä¸å†…ç½‘ç½‘æ®µå†²çªäº†â€”â€”dockerçš„ç½‘æ®µæ­£å¥½è¦†ç›–äº†å†…ç½‘ç½‘æ®µ

# 5ã€ä¿®æ”¹dockerç½‘å¡åœ°å€

1ï¼‰vim /etc/docker/daemon.jsonï¼ˆè¿™é‡Œæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶çš„è¯ï¼Œè‡ªè¡Œåˆ›å»ºï¼‰
```json
{
    "bip":"192.168.0.1/24"
}
```

2ï¼‰é‡å¯docker
```sh
systemctl restart docker
```

3) ifconfig å’Œ routeæ£€æŸ¥ç½‘å¡åœ°å€å’Œè·¯ç”±è¡¨

![ping](https://ae04.alicdn.com/kf/Ub1ef8e3cb5cc4636bd7ebcbabfedfaaeM.jpg)

ä½¿ç”¨å†…ç½‘åœ°å€ä¹Ÿèƒ½äº’ç›¸pingé€šäº†ã€‚ğŸ˜Š

# 6ã€æµ‹è¯•ä¸€ä¸‹å†…ç½‘å¸¦å®½

ä¸€ç«¯å¼€å¯æœåŠ¡ï¼Œç›‘å¬æµé‡
```sh
root@report:~ $ iperf3 -s
-----------------------------------------------------------
Server listening on 5201
-----------------------------------------------------------
```
ä¸€æ®µè¿æ¥æµ‹è¯•
```sh
iperf3 -c 172.168.0.11
Connecting to host report, port 5201
[  4] local 172.17.240.11 port 42010 connected to 172.17.0.11 port 5201
[ ID] Interval           Transfer     Bandwidth       Retr  Cwnd
[  4]   0.00-1.00   sec   300 MBytes  2.52 Gbits/sec  1820    229 KBytes
[  4]   1.00-2.00   sec   182 MBytes  1.53 Gbits/sec  284    325 KBytes
[  4]   2.00-3.00   sec   181 MBytes  1.52 Gbits/sec  399    212 KBytes
[  4]   3.00-4.00   sec   176 MBytes  1.48 Gbits/sec  263    250 KBytes
[  4]   4.00-5.00   sec   186 MBytes  1.56 Gbits/sec  407    237 KBytes
[  4]   5.00-6.00   sec   190 MBytes  1.59 Gbits/sec  362    148 KBytes
[  4]   6.00-7.00   sec   182 MBytes  1.53 Gbits/sec  247    321 KBytes
[  4]   7.00-8.00   sec   185 MBytes  1.55 Gbits/sec  331    328 KBytes
[  4]   8.00-9.00   sec   181 MBytes  1.52 Gbits/sec  425    215 KBytes
[  4]   9.00-10.00  sec   170 MBytes  1.43 Gbits/sec  206    309 KBytes
- - - - - - - - - - - - - - - - - - - - - - - - -
[ ID] Interval           Transfer     Bandwidth       Retr
[  4]   0.00-10.00  sec  1.89 GBytes  1.62 Gbits/sec  4744             sender
[  4]   0.00-10.00  sec  1.89 GBytes  1.62 Gbits/sec                  receiver

iperf Done.
```

åš¯ï¼Œæœç„¶ç‰›é€¼ï¼Œ1.6Gå¸¦å®½å¦¥å¦¥çš„ã€‚ğŸ˜„
